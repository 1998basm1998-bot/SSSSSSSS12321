<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø© - Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØµÙØ­</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { background-color: #28a745; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #218838; }
        .error { color: red; font-size: 14px; }
        .hidden { display: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; }
        th { background-color: #f2f2f2; }
        .logout-btn { background-color: #dc3545; margin-top: 20px; }
        .nav-link { display: block; margin-top: 15px; color: #007bff; text-decoration: none; cursor: pointer; }
    </style>
</head>
<body>

    <div class="container" id="app">
        </div>

    <script>
        // --- 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© (LocalStorage) ---
        const DB_KEY = 'accounting_system_users';
        const SESSION_KEY = 'accounting_system_session';

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        function initDB() {
            let users = JSON.parse(localStorage.getItem(DB_KEY));
            if (!users) {
                users = [
                    { id: 1, username: 'admin', password: '123', role: 'admin' },
                    { id: 2, username: 'user', password: '123', role: 'user' }
                ];
                localStorage.setItem(DB_KEY, JSON.stringify(users));
            }
        }

        // --- 2. Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        function getUsers() {
            return JSON.parse(localStorage.getItem(DB_KEY));
        }

        function addUser(username, password, role) {
            let users = getUsers();
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙƒØ±Ø§Ø± Ø§Ù„Ø§Ø³Ù…
            if(users.find(u => u.username === username)) return false; 
            
            let newId = users.length > 0 ? users[users.length - 1].id + 1 : 1;
            users.push({ id: newId, username, password, role });
            localStorage.setItem(DB_KEY, JSON.stringify(users));
            return true;
        }

        function loginUser(username, password) {
            let users = getUsers();
            let user = users.find(u => u.username === username && u.password === password);
            if (user) {
                localStorage.setItem(SESSION_KEY, JSON.stringify(user));
                return user;
            }
            return null;
        }

        function getCurrentUser() {
            return JSON.parse(localStorage.getItem(SESSION_KEY));
        }

        function logout() {
            localStorage.removeItem(SESSION_KEY);
            renderLogin();
        }

        // --- 3. Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ (Ø§Ù„Ø´Ø§Ø´Ø§Øª) ---

        // Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function renderLogin() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <div id="loginError" class="error"></div>
                <input type="text" id="loginUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¬Ø±Ø¨: admin)">
                <input type="password" id="loginPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø¬Ø±Ø¨: 123)">
                <button onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
            `;
        }

        // Ø´Ø§Ø´Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function renderDashboard() {
            const user = getCurrentUser();
            if (!user) { renderLogin(); return; }

            const app = document.getElementById('app');
            let adminControls = '';
            
            if (user.role === 'admin') {
                adminControls = `<a class="nav-link" onclick="renderUserManagement()">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯)</a>`;
            }

            app.innerHTML = `
                <h2>Ù…Ø±Ø­Ø¨Ø§ ${user.username}</h2>
                <p>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <strong>${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' : 'Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ'}</strong></p>
                <hr>
                <p>Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶Ù‡ Ù‡Ù†Ø§</p>
                ${adminControls}
                <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            `;
        }

        // Ø´Ø§Ø´Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù„Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·)
        function renderUserManagement() {
            const user = getCurrentUser();
            if (!user || user.role !== 'admin') { renderDashboard(); return; }

            const users = getUsers();
            let userRows = users.map(u => `<tr><td>${u.username}</td><td>${u.role}</td></tr>`).join('');

            const app = document.getElementById('app');
            app.innerHTML = `
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <div id="addError" class="error"></div>
                <input type="text" id="newUser" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                <input type="password" id="newPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                <select id="newRole">
                    <option value="user">Ø¹Ø¶Ùˆ</option>
                    <option value="admin">Ø£Ø¯Ù…Ù†</option>
                </select>
                <button onclick="handleAddUser()">Ø¥Ø¶Ø§ÙØ©</button>
                <hr>
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                <table>
                    <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</th></tr>
                    ${userRows}
                </table>
                <a class="nav-link" onclick="renderDashboard()">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            `;
        }

        // --- 4. Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ (Handlers) ---

        function handleLogin() {
            const u = document.getElementById('loginUser').value;
            const p = document.getElementById('loginPass').value;
            
            if (loginUser(u, p)) {
                renderDashboard();
            } else {
                document.getElementById('loginError').innerText = "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
            }
        }

        function handleAddUser() {
            const u = document.getElementById('newUser').value;
            const p = document.getElementById('newPass').value;
            const r = document.getElementById('newRole').value;

            if (u && p) {
                if(addUser(u, p, r)) {
                    alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                    renderUserManagement(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                } else {
                    document.getElementById('addError').innerText = "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹";
                }
            } else {
                document.getElementById('addError').innerText = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„";
            }
        }

        // --- 5. Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ ---
        initDB(); // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (getCurrentUser()) {
            renderDashboard();
        } else {
            renderLogin();
        }

    </script>
</body>
</html>
